<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>üçÖ Tomato Ripeness Detector</title>

<style>
body { text-align:center; font-family:Arial; padding:20px; }
video, img { width:90%; max-width:400px; border-radius:10px; margin-top:10px; }
button { padding:10px 20px; background:#d63384; color:white; border:none; border-radius:10px; }
#status { margin-top:15px; font-size:18px; font-weight:bold; color:#0d6efd; }
</style>

</head>
<body>

<h2>üçÖ Tomato Ripeness Detector</h2>

<video id="camera" autoplay playsinline></video><br>
<button onclick="capturePhoto()">üì∏ Scan Tomato</button>
<p id="status"></p>
<canvas id="snapshot" style="display:none;"></canvas>
<img id="result"/>

<script>
const video = document.getElementById("camera");
const canvas = document.getElementById("snapshot");
const result = document.getElementById("result");
const statusTxt = document.getElementById("status");

// Start back camera
navigator.mediaDevices.getUserMedia({ video:{ facingMode:"environment" } })
  .then(stream => video.srcObject = stream);

// Capture and send image
async function capturePhoto() {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video,0,0);
  
  const blob = await new Promise(res => canvas.toBlob(res,"image/jpeg"));
  sendImage(blob);
}

async function sendImage(blob){
  const fd = new FormData();
  fd.append("image", blob, "photo.jpg");

  statusTxt.textContent = "Detecting...";

  // IMPORTANT: FULL API URL
  const apiURL = "https://tomato-ripeness-detection.onrender.com/detect";

  try {
    const res = await fetch(apiURL, { method:"POST", body:fd });
    const data = await res.json();

    if(data.status){
      statusTxt.textContent = "‚úî " + data.status;
      result.src = "data:image/jpeg;base64," + data.image_base64;
    } else {
      statusTxt.textContent = "Error: " + data.error;
    }

  } catch (err){
    statusTxt.textContent = "‚ö†Ô∏è Network error ‚Äî cannot reach server.";
    console.error(err);
  }
}
</script>

</body>
</html>

